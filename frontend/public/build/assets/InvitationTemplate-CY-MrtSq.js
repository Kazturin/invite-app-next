import{F as me,j as Y,X as ue,L as ee,o as te,N as be}from"./fabric-C48elvu5.js";import{Z as fe,_ as ne,$ as pe}from"./vendor-BoxHjOd3.js";import{r as j,a as he,q as p,f as u,s as o,F as Z,t as oe,I as T,L as re,H as Q,y as c,U as se,b as B,A as z,w as ve,o as ye,W as xe,K as we,X as je}from"./vendor-vue-BcvRxASC.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const v=1140,y=1620,ae=[{original:"/images/bg/1.jpg",thumbnail:"/images/bg/thumbnails/1.jpg"},{original:"/images/bg/2.jpg",thumbnail:"/images/bg/thumbnails/2.jpg"},{original:"/images/bg/3.jpg",thumbnail:"/images/bg/thumbnails/3.jpg"},{original:"/images/bg/4.jpg",thumbnail:"/images/bg/thumbnails/4.jpg"},{original:"/images/bg/5.jpg",thumbnail:"/images/bg/thumbnails/5.jpg"},{original:"/images/bg/6.jpg",thumbnail:"/images/bg/thumbnails/6.jpg"},{original:"/images/bg/7.jpg",thumbnail:"/images/bg/thumbnails/7.jpg"},{original:"/images/bg/8.jpg",thumbnail:"/images/bg/thumbnails/8.jpg"},{original:"/images/bg/9.jpg",thumbnail:"/images/bg/thumbnails/9.jpg"},{original:"/images/bg/10.jpg",thumbnail:"/images/bg/thumbnails/10.jpg"},{original:"/images/bg/11.jpg",thumbnail:"/images/bg/thumbnails/11.jpg"},{original:"/images/bg/12.jpg",thumbnail:"/images/bg/thumbnails/12.jpg"}],ke=[{key:"Academy",name:"Academy"},{key:"Mon",name:"Mon Amour One"},{key:"Balmoral",name:"Balmoral"},{key:"RosaMarena",name:"Rosa Marena"},{key:"RussoOne-Regular",name:"RussoOne-Regular"},{key:"Baltica",name:"Baltica"},{key:"Vivaldi",name:"Vivaldi"},{key:"Boyarsky",name:"Boyarsky"},{key:"Taurus",name:"Taurus"},{key:"Cooper",name:"Cooper"},{key:"Downtown",name:"Downtown"},{key:"TimpaniStars",name:"TimpaniStars"},{key:"Blondie",name:"Sanasoft Blondie"},{key:"Poster",name:"Poster"},{key:"Bernn",name:"vBernn"},{key:"Handel",name:"Handel"}],Ce=typeof window<"u";let le="";if(Ce){const i=new Blob([fe],{type:"application/javascript"});le=URL.createObjectURL(i)}function Se(i,l){const r=j(null),s=j(null);let e=null,d=null;const m=j(null),h=()=>{if(!r.value)return;const t=me.createObjectDefaultControls();delete t.mt,delete t.mb,delete t.ml,delete t.mr,Y.ownDefaults={...Y.ownDefaults,controls:t,cornerStyle:"circle",cornerStrokeColor:"blue",cornerColor:"lightblue",padding:5,transparentCorners:!1,borderColor:"orange"},e=new ue(r.value,{width:v,height:y,backgroundColor:"transparent",preserveObjectStacking:!0}),Y.createControls=()=>({}),ee.prototype.toObject=(function(n){return function(a){return n.call(this,["isTemplateFrame","isUserImage",...a])}})(ee.prototype.toObject),e.on("selection:created",n=>m.value=n.selected[0]),e.on("selection:updated",n=>m.value=n.selected[0]),e.on("selection:cleared",()=>m.value=null),e.on("object:modified",g),e.on("object:added",g),e.on("object:removed",g)},k=()=>{if(!e||!s.value)return;const t=s.value.clientWidth,n=t/v,a=y*n;e.setDimensions({width:t,height:a}),e.setZoom(n),e.calcOffset(),e.renderAll()},C=()=>{s.value&&(d=new ResizeObserver(()=>{k()}),d.observe(s.value))},g=()=>{if(e){const t=e.toJSON();t.objects=t.objects.filter(n=>!n.isTemplateFrame),l("update:content",t)}},S=async t=>{try{const n=await Promise.all(t.map(a=>document.fonts.load(`1em ${a}`)))}catch(n){console.error("Error loading fonts:",n)}},R=async()=>{if(!e)return;if(i.content&&i.content.objects){const n=[...new Set(i.content.objects.filter(a=>["i-text","IText"].includes(a.type)&&a.fontFamily).map(a=>a.fontFamily))];n.length>0&&await S(n)}const t=e.backgroundColor;if(e.clear(),e.backgroundColor=t,i.content&&Object.keys(i.content).length>0&&await new Promise(n=>{e.loadFromJSON(i.content,()=>{e.requestRenderAll(),n()})}),i.template?.without_text&&!e.getObjects().find(a=>a.isTemplateFrame===!0))try{const a=await te.fromURL(i.template.without_text);a.set({scaleX:v/a.width,scaleY:y/a.height,selectable:!1,evented:!1,isTemplateFrame:!0}),a.scaleToWidth(v),a.scaleToHeight(y),e.add(a)}catch(a){console.error("Error loading template frame:",a)}F(),e.requestRenderAll(),g()},F=()=>{if(!e)return;const t=e.getObjects().find(a=>a.isUserImage===!0),n=e.getObjects().find(a=>a.isTemplateFrame===!0);t&&e.sendObjectToBack(t),n&&(t?e.moveObjectTo(n,1):e.sendObjectToBack(n)),e.requestRenderAll()},_=async()=>{if(e&&confirm("Текст енгізесіз бе?")){await S(["Academy"]);const t=new be("Новый текст",{left:10,top:10,width:500,fontSize:60,fill:"#000000",fontFamily:"Academy",textAlign:"center"});e.add(t),e.setActiveObject(t),e.requestRenderAll(),g()}},D=t=>{const n=e.getActiveObject();if(n&&["i-text","IText"].includes(n.type)){const a=(n.fontSize||40)+t;n.set("fontSize",Math.max(1,a)),e.requestRenderAll(),g()}},W=t=>{const n=e.getActiveObject();n&&["i-text","IText"].includes(n.type)&&(n.set("fontSize",parseInt(t,10)||40),e.requestRenderAll(),g())},U=t=>{const n=e.getActiveObject();n&&["i-text","IText"].includes(n.type)&&(n.set("fill",t),e.requestRenderAll(),g())},q=()=>{const t=e.getActiveObject();t&&["i-text","IText"].includes(t.type)&&(t.set("fontStyle",t.fontStyle==="italic"?"normal":"italic"),e.requestRenderAll(),g())},L=()=>{const t=e.getActiveObject();t&&["i-text","IText"].includes(t.type)&&(t.set("fontWeight",t.fontWeight==="bold"?"normal":"bold"),e.requestRenderAll(),g())},E=()=>{const t=e.getActiveObject();t&&(e.viewportCenterObjectH(t),e.requestRenderAll(),g())},N=async t=>{const n=e.getActiveObject();n&&["i-text","IText"].includes(n.type)&&(await S([t]),n.set("fontFamily",t),e.requestRenderAll(),g())},H=t=>{const n=e.getActiveObject();if(n&&["i-text","IText"].includes(n.type)){const a=n.text;t==="uppercase"?n.set("text",a.toUpperCase()):t==="lowercase"&&n.set("text",a.toLowerCase()),e.requestRenderAll(),g()}},I=()=>{const t=e.getActiveObject();t&&confirm("Удалить выбранный объект?")&&(e.remove(t),t.isUserImage&&g())},M=async t=>{const n=new FormData;n.append("image",t);try{const a=await fetch("/api/upload-image",{method:"POST",body:n,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(!a.ok)throw new Error("Server upload failed");return(await a.json()).url}catch(a){return console.error("Error uploading image:",a),null}},G=async t=>{if(!(!t||!e))try{const n=await M(t);if(!n)return;const a=e.getObjects().find(V=>V.isUserImage===!0);a&&e.remove(a);const x=await te.fromURL(n);x.set({top:y/2,left:v/2,originX:"center",originY:"center",isUserImage:!0}),x.scaleToWidth(v*.8),e.add(x),e.setActiveObject(x),F(),g()}catch(n){console.error("Error adding image:",n)}},P=async t=>{try{const a=await(await fetch(t)).arrayBuffer(),x=ne.parseGIF(a),V=ne.decompressFrames(x,!0),X=document.createElement("canvas"),O=X.getContext("2d");X.width=v,X.height=y;const w=e.getObjects().find(f=>f.isTemplateFrame===!0),ce=w?w.visible:!0;w&&(w.visible=!1),e.renderAll();const de=e.toDataURL({format:"png",multiplier:1}),K=new Image;await new Promise(f=>{K.onload=f,K.src=de}),w&&(w.visible=ce),e.renderAll();const J=new pe({workers:2,quality:10,width:v,height:y,workerScript:le});for(const f of V){const A=O.createImageData(f.dims.width,f.dims.height);A.data.set(f.patch),O.putImageData(A,f.dims.left,f.dims.top),O.drawImage(K,0,0,v,y),J.addFrame(O,{copy:!0,delay:f.delay})}return new Promise((f,A)=>{J.on("finished",ge=>{const $=new FileReader;$.onloadend=()=>f($.result),$.onerror=A,$.readAsDataURL(ge)}),J.render()})}catch(n){throw console.error("GIF export error",n),n}},b=async()=>{if(!e)return null;const t=i.template?.without_text;if(console.log(t),t&&t.toLowerCase().endsWith(".gif"))try{return console.log("exporting as gif"),await P(t)}catch(n){console.error("Failed to export as GIF, falling back to static",n)}return e.toDataURL({format:"png",quality:.8,multiplier:2})};return he(()=>{d&&s.value&&d.unobserve(s.value),e&&e.dispose()}),{fabricCanvas:r,canvasWrapper:s,selectedObject:m,initCanvas:h,loadCanvasState:R,setupResizeObserver:C,resizeCanvas:k,addText:_,changeFontSize:D,setFontSize:W,changeTextColor:U,changeFontStyle:q,changeFontWeight:L,centerText:E,changeFont:N,changeTextCase:H,deleteSelected:I,addImage:G,exportAsImage:b}}const Te={class:"flex flex-wrap items-center justify-center gap-2"},Fe={class:"text-center flex items-center space-x-4 border-gray-600 pr-3 border-r"},Ie={class:"flex items-center border-2 border-gray-500 rounded-xl overflow-hidden"},Oe={class:"flex items-center text-gray-500 border-l border-r border-gray-500"},Ae=["value"],$e={class:"flex items-center space-x-4 border-r border-gray-600 pr-3 md:pr-6"},Be=["value"],ze={class:"text-left"},Re=["value"],_e=["value"],De={key:1,class:"text-2xl md:text-3xl font-baltica"},We={__name:"TextToolbar",props:{selectedObject:{type:Object,default:null},fonts:{type:Array,required:!0}},emits:["addText","changeFontStyle","changeFontWeight","changeFontSize","setFontSize","changeTextColor","centerText","changeFont","deleteSelected","changeTextCase"],setup(i){return(l,r)=>(u(),p("div",Te,[o("button",{onClick:r[0]||(r[0]=s=>l.$emit("addText")),title:"Добавить текст"},[...r[12]||(r[12]=[o("img",{src:"/icons/add_text.svg",alt:"Добавить текст",class:"w-7 h-7 md:w-10 md:h-10"},null,-1)])]),i.selectedObject&&i.selectedObject.type==="i-text"?(u(),p(Z,{key:0},[o("button",{onClick:r[1]||(r[1]=s=>l.$emit("changeFontStyle")),class:T(["border-2 border-gray-400 text-gray-400 w-7 h-7 md:w-10 md:h-10 p-1 italic font-academy text-xs md:text-base flex items-center justify-center hover:bg-gray-100",{"bg-gray-200":i.selectedObject.fontStyle==="italic"}])}," I ",2),o("button",{onClick:r[2]||(r[2]=s=>l.$emit("changeFontWeight")),class:T(["border-2 border-gray-400 text-gray-400 w-7 h-7 md:w-10 md:h-10 p-1 font-bold text-xs md:text-base flex items-center justify-center hover:bg-gray-100",{"bg-gray-200":i.selectedObject.fontWeight==="bold"}])}," B ",2),o("button",{onClick:r[3]||(r[3]=s=>l.$emit("changeTextCase","uppercase")),class:"border-2 border-gray-400 text-gray-400 w-7 h-7 md:w-10 md:h-10 p-1 font-bold text-xs md:text-sm flex items-center justify-center hover:bg-gray-100",title:"Uppercase"}," AA "),o("button",{onClick:r[4]||(r[4]=s=>l.$emit("changeTextCase","lowercase")),class:"border-2 border-gray-400 text-gray-400 w-7 h-7 md:w-10 md:h-10 p-1 font-bold text-xs md:text-sm flex items-center justify-center hover:bg-gray-100",title:"Lowercase"}," aa "),o("div",Fe,[o("div",Ie,[o("div",{onClick:r[5]||(r[5]=s=>l.$emit("changeFontSize",2)),class:"select-none cursor-pointer p-1 text-xl font-semibold w-7 h-7 md:w-10 md:h-10 text-gray-500"}," +"),o("div",Oe,[o("input",{type:"number",value:Math.round(i.selectedObject.fontSize),onInput:r[6]||(r[6]=s=>l.$emit("setFontSize",s.target.value)),min:"20",max:"176",class:"border-none p-0 text-xs md:text-sm w-7 h-7 md:w-10 md:h-10 font-semibold text-center"},null,40,Ae)]),o("div",{onClick:r[7]||(r[7]=s=>l.$emit("changeFontSize",-2)),class:"select-none cursor-pointer p-1 text-xl font-semibold w-7 h-7 md:w-10 md:h-10 text-gray-500"}," -")])]),o("div",$e,[o("input",{type:"color",class:"w-7 h-7 md:w-10 md:h-10 rounded-md",value:i.selectedObject.fill,onInput:r[8]||(r[8]=s=>l.$emit("changeTextColor",s.target.value))},null,40,Be)]),o("button",{class:"text-gray-500 border-r border-gray-600 pr-3 md:pr-6",onClick:r[9]||(r[9]=s=>l.$emit("centerText")),title:"Центрировать текст"},[...r[13]||(r[13]=[o("svg",{class:"mx-auto w-7 h-7 md:w-10 md:h-10 text-gray-500",fill:"currentColor",viewBox:"0 0 24 24"},[o("path",{d:"m6 17.75c0-.414.336-.75.75-.75h10.5c.414 0 .75.336.75.75s-.336.75-.75.75h-10.5c-.414 0-.75-.336-.75-.75zm-4-4c0-.414.336-.75.75-.75h18.5c.414 0 .75.336.75.75s-.336.75-.75.75h-18.5c-.414 0-.75-.336-.75-.75zm0-4c0-.414.336-.75.75-.75h18.5c.414 0 .75.336.75.75s-.336.75-.75.75h-18.5c-.414 0-.75-.336-.75-.75zm4-4c0-.414.336-.75.75-.75h10.5c.414 0 .75.336.75.75s-.336.75-.75.75h-10.5c-.414 0-.75-.336-.75-.75z","fill-rule":"nonzero"})],-1)])]),o("div",ze,[o("select",{value:i.selectedObject.fontFamily,onChange:r[10]||(r[10]=s=>l.$emit("changeFont",s.target.value)),class:"rounded-md p-1 md:p-2"},[(u(!0),p(Z,null,re(i.fonts,s=>(u(),p("option",{key:s.key,value:s.key,class:"text-base md:text-lg"},Q(s.name),9,_e))),128))],40,Re)]),oe(c(se),{onClick:r[11]||(r[11]=s=>l.$emit("deleteSelected")),class:"text-red-500 w-7 h-7 md:w-10 md:h-10 cursor-pointer"})],64)):(u(),p("p",De,Q(l.$t("select_text")),1))]))}},Ue={class:"flex justify-center space-x-2 overflow-x-auto py-2 bg-gray-100 border-b border-gray-300"},qe={class:"slider-container"},Le={class:"slider"},Ee=["onClick"],Ne=["src"],He={__name:"BackgroundToolbar",props:{backgroundImages:{type:Array,required:!0},currentBg:{type:String,default:""}},emits:["changeBackground"],setup(i){return(l,r)=>(u(),p("div",Ue,[o("div",qe,[o("div",Le,[(u(!0),p(Z,null,re(i.backgroundImages,(s,e)=>(u(),p("div",{key:e,class:T(["slider-item",{selected:i.currentBg===s.original}]),onClick:d=>l.$emit("changeBackground",s.original)},[o("img",{src:s.thumbnail,alt:"Background",class:"slider-image"},null,8,Ne)],10,Ee))),128))])])]))}},Me=ie(He,[["__scopeId","data-v-0c6c3268"]]),Ge={class:"flex justify-center items-center gap-4 py-4"},Pe={__name:"ImageToolbar",props:{selectedObject:{type:Object,default:null}},emits:["deleteSelected","addImage"],setup(i,{emit:l}){const r=l,s=j(null),e=()=>{s.value?.click()},d=m=>{const h=m.target.files[0];h&&(r("addImage",h),m.target.value="")};return(m,h)=>(u(),p("div",Ge,[o("button",{onClick:e,class:"bg-blue-500 text-white px-6 py-3 rounded-lg text-2xl"}," Суретті өзгерту "),i.selectedObject&&i.selectedObject.isUserImage?(u(),B(c(se),{key:0,onClick:h[0]||(h[0]=k=>m.$emit("deleteSelected")),class:"text-red-500 w-7 h-7 md:w-10 md:h-10 cursor-pointer"})):z("",!0),o("input",{ref_key:"fileInput",ref:s,type:"file",onChange:d,class:"hidden",accept:"image/*"},null,544)]))}},Ve={class:"relative"},Xe={class:"flex space-x-4 justify-center items-center py-4"},Ke={class:"w-full max-w-lg mx-auto mb-4"},Je={class:"bg-white border-gray-600 border my-2"},Ye={class:"min-h-[120px] flex flex-wrap items-center justify-center gap-2 px-4 py-2"},Ze={class:"relative z-10"},Qe={__name:"InvitationTemplate",props:{template:{type:Object,required:!0},content:{required:!0},edit:{type:Boolean},bg_img:{type:String}},emits:["update:content","update:bg_img"],setup(i,{expose:l,emit:r}){const s=i,e=r,d=j("text"),m=j(null),{fabricCanvas:h,canvasWrapper:k,selectedObject:C,initCanvas:g,loadCanvasState:S,setupResizeObserver:R,resizeCanvas:F,addText:_,changeFontSize:D,setFontSize:W,changeTextColor:U,changeFontStyle:q,changeFontWeight:L,centerText:E,changeFont:N,changeTextCase:H,deleteSelected:I,addImage:M,exportAsImage:G}=Se(s,e),P=b=>{m.value=b,e("update:bg_img",b)};return ve(C,b=>{b&&(b.type==="i-text"?d.value="text":b.type==="image"&&(console.log(b.type),d.value="image"))}),ye(async()=>{await xe(),g(),await S(),R(),await new Promise(b=>setTimeout(b,100)),F(),m.value=s.bg_img||ae[0]?.original,m.value&&e("update:bg_img",m.value)}),l({exportAsImage:G}),(b,t)=>(u(),p("div",Ve,[o("div",Xe,[o("div",{onClick:t[0]||(t[0]=n=>d.value="text"),class:T(["cursor-pointer text-center",{"text-blue-500":d.value==="text"}])},[...t[2]||(t[2]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6 mx-auto",viewBox:"0 0 24 24"},[o("path",{fill:"currentColor",d:"M22 0h-20v6h1.999c0-1.174.397-3 2.001-3h4v16.874c0 1.174-.825 2.126-2 2.126h-1v2h9.999v-2h-.999c-1.174 0-2-.952-2-2.126v-16.874h4c1.649 0 2.02 1.826 2.02 3h1.98v-6z"})],-1),o("p",null,"Текст",-1)])],2),o("div",{onClick:t[1]||(t[1]=n=>d.value="bg"),class:T(["cursor-pointer text-center",{"text-blue-500":d.value==="bg"}])},[oe(c(we),{class:"w-7 h-7 mx-auto"}),o("p",null,Q(b.$t("button.background_color")),1)],2)]),o("div",Ke,[o("div",Je,[o("div",Ye,[d.value==="text"?(u(),B(We,{key:0,selectedObject:c(C),fonts:c(ke),onAddText:c(_),onChangeFontStyle:c(q),onChangeFontWeight:c(L),onChangeFontSize:c(D),onSetFontSize:c(W),onChangeTextColor:c(U),onCenterText:c(E),onChangeFont:c(N),onDeleteSelected:c(I),onChangeTextCase:c(H)},null,8,["selectedObject","fonts","onAddText","onChangeFontStyle","onChangeFontWeight","onChangeFontSize","onSetFontSize","onChangeTextColor","onCenterText","onChangeFont","onDeleteSelected","onChangeTextCase"])):z("",!0),d.value==="bg"?(u(),B(Me,{key:1,backgroundImages:c(ae),currentBg:m.value,onChangeBackground:P},null,8,["backgroundImages","currentBg"])):z("",!0),d.value==="image"?(u(),B(Pe,{key:2,selectedObject:c(C),onAddImage:c(M),onDeleteSelected:c(I)},null,8,["selectedObject","onAddImage","onDeleteSelected"])):z("",!0)])])]),o("div",{style:je({backgroundImage:`url(${m.value})`}),class:"relative block h-[700px] sm:h-[900px] bg-no-repeat bg-cover mb-10 flex justify-center items-center p-4"},[o("div",{ref_key:"canvasWrapper",ref:k,class:"relative w-full h-full max-w-lg"},[o("div",Ze,[o("canvas",{ref_key:"fabricCanvas",ref:h,class:"border-amber-500 border top-0 left-0"},null,512)])],512)],4)]))}},ot=ie(Qe,[["__scopeId","data-v-eae0b190"]]);export{ot as I};
